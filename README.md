Запуск: uvicorn main:app --reload

Этот бэкенд предоставляет API для получения топливных токенов, обрабатывая запросы на выдачу топлива и взаимодействуя с внешним сервисом для фактического получения данных.

Установленные ограничения
Частота запросов: Один запрос в секунду для каждого tank_id.
Максимальное количество топлива: При запросе указывается количество топлива, но API ограничивает запрос до 10 единиц за один раз.
Эндпоинт
POST /get_fuel
Обрабатывает запросы на получение топлива для указанного идентификатора танка (tank_id) и количества топлива (count).

Запрос
Тело запроса:

json
Копировать код
{
    "tank_id": <int>, // ID танка
    "count": <int>    // Количество топлива для запроса
}
tank_id: Идентификатор танка (целое число).
count: Запрашиваемое количество топлива (целое число, > 0).
Ответ
Тело ответа (успех):

json
Копировать код
{
    "fuel": [
        {"fuel_id": 1, "quantity": 1},
        {"fuel_id": 2, "quantity": 1},
        ...
    ]
}
fuel: Массив объектов, каждый из которых представляет топливный токен.
fuel_id: Уникальный идентификатор токена в рамках ответа.
quantity: Количество топлива, связанное с токеном (возвращается из внешнего сервиса).
Ошибки
400 Bad Request: Если count <= 0.
429 Too Many Requests: Если запросы от одного tank_id поступают чаще, чем раз в секунду.
json
Копировать код
{
    "detail": "Too many requests. Please wait <X> seconds."
}
500 Internal Server Error: Если произошла ошибка при взаимодействии с внешним сервисом или внутри сервиса.
json
Копировать код
{
    "detail": "<описание ошибки>"
}
Логика работы
Ограничение частоты запросов:

Проверяется время последнего запроса для tank_id с помощью словаря last_request_time.
Если разница между текущим временем и временем последнего запроса меньше REQUEST_LIMIT_SECONDS, возвращается ошибка 429.
Решение о количестве топлива:

Если в запросе указано количество топлива больше 10, оно уменьшается до 10.
Взаимодействие с внешним сервисом:

Отправляется POST-запрос на внешний сервис (EXTERNAL_SERVICE_URL), в теле передаются:
json
Копировать код
{
    "tank_id": <int>,
    "count": <int>
}
Ответ сервиса обрабатывается, и из него извлекается количество топлива.
Формирование ответа:

На основе полученного количества топлива создаётся массив токенов, каждый из которых включает уникальный fuel_id и количество топлива.
Пример использования
Пример запроса:
json
Копировать код
POST /get_fuel
Content-Type: application/json

{
    "tank_id": 101,
    "count": 5
}
Пример ответа:
json
Копировать код
{
    "fuel": [
        {"fuel_id": 1, "quantity": 1},
        {"fuel_id": 2, "quantity": 1},
        {"fuel_id": 3, "quantity": 1},
        {"fuel_id": 4, "quantity": 1},
        {"fuel_id": 5, "quantity": 1}
    ]
}
Настройки
EXTERNAL_SERVICE_URL: URL внешнего сервиса для получения данных о топливе.
REQUEST_LIMIT_SECONDS: Интервал времени в секундах между запросами от одного tank_id.
Примечания
Если внешний сервис возвращает данные в ином формате, необходимо скорректировать обработку ответа в коде.
Для продакшена рекомендуется добавить:
Логирование для мониторинга ошибок и успешных запросов.
Обработку тайм-аутов для внешнего сервиса.
